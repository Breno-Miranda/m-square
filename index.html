<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3QK6CR1BXY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-3QK6CR1BXY');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M-Square | Video steams square multiScreen</title>
    <meta name="description" content="M-Square: Visualiza√ß√£o simult√¢nea de m√∫ltiplos v√≠deos com design premium.">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="floating-logo">
        <span class="logo-icon">üöÄ</span>
        <span class="logo-text">M-SQUARE</span>
    </div>

    <main class="grid-main">
        <div id="videoContainer" class="video-grid">
            <!-- Os v√≠deos ser√£o injetados via JS ou renderizados inicialmente -->
        </div>
    </main>

    <div class="floating-control">
        <button class="btn-settings" onclick="openModal()">
            <span>‚öôÔ∏è</span> Configurar Canais
        </button>
    </div>

    <!-- Modal de Configura√ß√£o -->
    <div id="settingsModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Gerenciar Streams</h3>
            </div>
            <div id="inputContainer">
                <!-- Inputs ser√£o gerados dinamicamente -->
            </div>
            <div class="modal-footer">
                <button class="btn-close" onclick="closeModal()">Cancelar</button>
                <button class="btn-save" onclick="saveSettings()">Salvar Configura√ß√µes</button>
            </div>
        </div>
    </div>

    <div class="version-badge">V0.10.25</div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        const playerIds = ['player1', 'player2', 'player3', 'player4'];
        let players = {};
        let lastClickTime = 0;

        // Canais Default
        const defaultVideos = [
            'XWjQEpRrgbE',
            '1kx--gAntwE',
            'krUGzTq00Z0',
            'YGNIRYKBqdc'
        ];

        // Inicializa√ß√£o
        function initApp() {
            const saved = localStorage.getItem('msquare_streams');
            const streamIds = saved ? JSON.parse(saved) : defaultVideos;
            renderGrid(streamIds);
            renderInputs(streamIds);
        }

        function renderGrid(ids) {
            const container = document.getElementById('videoContainer');
            const borders = ['border-primary', 'border-secondary', 'border-tertiary', 'border-gradient'];

            container.innerHTML = ids.map((id, index) => `
                <div class="video-item ${borders[index]}" onclick="toggleMute(event, 'player${index + 1}')" ondblclick="toggleFullscreen(event, this)">
                    <div class="video-overlay"></div>
                    <iframe id="player${index + 1}" 
                        src="https://www.youtube.com/embed/${id}?enablejsapi=1&autoplay=1&mute=1" 
                        allowfullscreen></iframe>
                </div>
            `).join('');
        }

        function renderInputs(ids) {
            const container = document.getElementById('inputContainer');
            container.innerHTML = ids.map((id, index) => `
                <div class="input-group">
                    <label>V√≠deo ${index + 1} (YouTube ID)</label>
                    <input type="text" id="inputV${index}" value="${id}" placeholder="Ex: XWjQEpRrgbE">
                </div>
            `).join('');
        }

        // YT API Callback
        function onYouTubeIframeAPIReady() {
            initApp();
            playerIds.forEach(id => {
                createPlayer(id);
            });
        }

        function createPlayer(id) {
            players[id] = new YT.Player(id, {
                events: {
                    'onReady': (event) => {
                        event.target.mute();
                        event.target.playVideo();
                    },
                    'onStateChange': (event) => {
                        if (event.data === YT.PlayerState.PAUSED) {
                            event.target.playVideo();
                        }
                    }
                }
            });
        }

        // Modal Logic
        function openModal() { document.getElementById('settingsModal').style.display = 'flex'; }
        function closeModal() { document.getElementById('settingsModal').style.display = 'none'; }

        function saveSettings() {
            const newIds = [];
            for (let i = 0; i < 4; i++) {
                const val = document.getElementById(`inputV${i}`).value.trim();
                newIds.push(val || defaultVideos[i]);
            }

            localStorage.setItem('msquare_streams', JSON.stringify(newIds));
            closeModal();

            // Reload page to re-initialize YT API with new IDs simplified approach for reliability
            window.location.reload();
        }

        function toggleFullscreen(e, element) {
            if (e) { e.stopPropagation(); }
            if (!document.fullscreenElement) {
                if (element.requestFullscreen) element.requestFullscreen();
                else if (element.webkitRequestFullscreen) element.webkitRequestFullscreen();

                const iframe = element.querySelector('iframe');
                if (iframe && players[iframe.id]) {
                    const id = iframe.id;
                    playerIds.forEach(pId => players[pId]?.mute?.());
                    players[id]?.unMute?.();
                    showStatus(id, 'Fullscreen Focus üì∫üîä');
                }
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
            }
        }

        function toggleMute(e, id) {
            if (e) { e.stopPropagation(); }
            const now = Date.now();
            if (now - lastClickTime < 300) { lastClickTime = now; return false; }
            lastClickTime = now;

            const targetPlayer = players[id];
            if (!targetPlayer || typeof targetPlayer.isMuted !== 'function') return false;

            const isCurrentlyMuted = targetPlayer.isMuted();
            playerIds.forEach(pId => players[pId]?.mute?.());

            if (isCurrentlyMuted) {
                targetPlayer.unMute();
                targetPlayer.playVideo();
                showStatus(id, 'Audio Focus üîä');
            } else {
                showStatus(id, 'All Muted üîá');
            }
            return false;
        }

        function showStatus(id, text) {
            const container = document.getElementById(id).parentElement;
            let status = container.querySelector('.status-indicator');
            if (!status) {
                status = document.createElement('div');
                status.className = 'status-indicator';
                container.appendChild(status);
            }
            status.textContent = text;
            status.classList.add('visible');
            setTimeout(() => status.classList.remove('visible'), 1500);
        }
    </script>
</body>

</html>